{"files":[{"id":"cd8b70a4-e0c6-4e18-b27b-eb35cf3ce9dd","name":"appsscript","type":"json","source":"{\n  \"timeZone\": \"Asia/Tokyo\",\n  \"dependencies\": {\n  },\n  \"exceptionLogging\": \"STACKDRIVER\",\n  \"runtimeVersion\": \"V8\"\n}"},{"id":"c7008c7e-d7a9-4a79-9498-b0e4c0890852","name":"send_mail","type":"server_js","source":"var holiday_ary \u003d [\n[\"2022/9/19\",\"敬老の日\"],\n[\"2022/9/23\",\"秋分の日\"],\n[\"2022/10/10\",\"スポーツの日\"],\n[\"2022/11/3\",\"文化の日\"],\n[\"2022/11/23\",\"勤労感謝の日\"]\n];\n\nfunction set_trigger_prj() {\n\n  var triggerDay \u003d new Date;\n\n  triggerDay.setDate(triggerDay.getDate() + 1);\n  triggerDay.setHours(07);\n  triggerDay.setMinutes(45);\n\n  var onChangeTrigger \u003d ScriptApp.newTrigger(\"set_trigger\")\n        .timeBased()\n        .at(triggerDay)\n        .create();\n}\n\nfunction set_trigger() {\n\n  var triggerDay \u003d new Date;\n\n  triggerDay.setHours(07)\n  triggerDay.setMinutes(45)\n\n  var onChangeTrigger \u003d ScriptApp.newTrigger(\"sendMail\")\n        .timeBased()\n        .at(triggerDay)\n        .create();\n}\n\nfunction del_set_trigger_Trigger() {\n\n  const triggers \u003d ScriptApp.getProjectTriggers();\n  for(const trigger of triggers){\n    if(trigger.getHandlerFunction() \u003d\u003d \"set_trigger\"){\n      ScriptApp.deleteTrigger(trigger);\n    }\n  }\n  \n}\nfunction del_sendMail_Trigger() {\n\n  const triggers \u003d ScriptApp.getProjectTriggers();\n  for(const trigger of triggers){\n    if(trigger.getHandlerFunction() \u003d\u003d \"sendMail\"){\n      ScriptApp.deleteTrigger(trigger);\n    }\n  }\n  \n}\n\nfunction sendMail() {\n\n  if (is_holiday_today()) {\n    Logger.log(\"is_holiday:true\");\n    return\n  }\n\n  const recipient \u003d \u0027a.nakamura@c-staffing.co.jp,m.kitagawa@c-staffing.co.jp,staff-sp@c-staffing.co.jp\u0027;\n  const subject \u003d \u0027出勤報告の件\u0027;\n  const body \u003d \n\u0027中村様\\n\u0027 +\n\u0027北川様\\n\u0027 +\n\u0027水井様\\n\u0027 +\n\u0027\\n\u0027 +\n\u0027今から出勤します。\\n\u0027 +\n\u0027\\n\u0027 +\n\u0027----------------------------------------\\n\u0027 +\n\u0027天野　剛\\n\u0027 +\n\u0027\\n\u0027 +\n\u0027070-5613-5811\\n\u0027 +\n\u0027goofree0001@gmail.com\\n\u0027 +\n\u0027----------------------------------------\\n\u0027;\n\n  GmailApp.sendEmail(recipient, subject, body);\n\n  del_set_trigger_Trigger();\n  del_sendMail_Trigger();\n\n  var triggerDay \u003d new Date;\n  triggerDay.setDate(triggerDay.getDate() + 1);\n  triggerDay.setHours(07);\n  triggerDay.setMinutes(45);\n\n  var onChangeTrigger \u003d ScriptApp.newTrigger(\"set_trigger\")\n        .timeBased()\n        .at(triggerDay)\n        .create();\n\n}\n\nfunction is_holiday_today() {\n  Logger.log(\"is_holiday_test start\");\n  var triggerDay \u003d new Date();\n  triggerDay.setDate(triggerDay.getDate() + 0);\n  triggerDay.setHours(00);\n  triggerDay.setMinutes(00);\n  triggerDay.setSeconds(00);\n  Logger.log(new Date(triggerDay));\n  var result \u003d is_holiday(triggerDay);\n  return result;\n}\n\nfunction is_holiday(check_day) {\n  var check_day \u003d new Date(check_day);\n\n  Logger.log(check_day);\n\n  if (check_day.getDay() \u003d\u003d 0 || check_day.getDay() \u003d\u003d 6) {\n    return true;\n  }\n\n  for (var holiday_str of holiday_ary) {\n    var holiday \u003d new Date(holiday_str[0]);\n    Logger.log(holiday);\n    if (date2str(holiday) \u003d\u003d date2str(check_day)) {\n      return true;\n    }\n  }\n    return false;\n}\n\nfunction date2str(target_day) {\n\n  //日付オブジェクトを作成する\n  var dd \u003d new Date(target_day);\n  //「年」を取得する\n  var YYYY \u003d dd.getFullYear();\n  //「月」を取得する\n  var MM \u003d dd.getMonth()+1;\n  //「日」を取得する\n  var DD \u003d dd.getDate();\n\n  return YYYY + \"/\" + MM + \"/\" + DD;\n\n}"}]}